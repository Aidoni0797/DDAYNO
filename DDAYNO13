DDAYNO13

Организация связей между таблицами - Один-Ко-Многим

Введение
Связь "один-ко-многим" (или "многие-к-одному") означает, что:
- Один объект главной модели может быть связан с многими объектами зависимой модели
- А каждый объект зависимой модели - только с одним объектом главной

Примеры таких связей:
- Компания - Товары
- Автомобиль - Запчасти
- Гостиница - Комнаты
- Книга - Авторы
- Город - Улицы
- Улица - Дома

Пример: Компания и её товары
1. Создаём приложение
python manage.py startapp onetomany

2. Модели
from django.db import models

class Company(models.Model):
  name = moels.CharField(max_length=30)

class Product(models.Model):
  company = models.oreignKey(Company, on_delete=models.CASCADE)
  name = models.CharField(max_length=30)
  price = models.IntegerField()

3. Что делает ForaignKey

Аргумент - Описание
Company - Модель с которой создаётся связь
on_delete = models.CASCADE - при удалении компании удаляется и её продукты

Миграции
python manage.py makemigrations
python manage.py migrate

Структура таблиц в базе данных

Создаются две таблицы:
onetomany_company
onetomany_product(с полем company_id - внешний ключ на Company)
Работа в Dkango shell

python manage.py shell

from onetomany.models import *

Создание объектов

#Создание компании
nestle = Company.objects.create(name='Nestle')

#Продукты этой компании
Product.objects.create(company=nestle, name='Chocolate', price=100)
Product.objects.create(company=nestle, name='Dragees', price=200)

Доступ к связанным объектам

Из Product в Company

product = Product.objects.get(name='Chocolate')

product.company.name
# 'Nestle'

Из Company в Product (через product_set)

nestle = Company.objects.get(name='Nestle')

#Все продукты этой компании
products = nestle.product_set.all()

#Количество продуктов
count = nestle.product_set.count()

#Продукты, название которых начинается на "Choc"
choco_products = nestle.product_set.filter(name__startswith="Choc")

product_set - это имя по умолчани. Его можно переопределить с помощью related_name

Пример с related_name
